<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ–æ›¸é¤¨æ¢éšªå®¶ - ç¾åœ‹ 250 æ™‚ç©ºèˆªè¡Œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f8fafc;
        }

        .card {
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            perspective: 1000px;
            cursor: pointer;
        }

        .card-inactive {
            filter: grayscale(100%) brightness(70%);
        }

        .card-active {
            filter: none;
            transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(245, 158, 11, 0.4);
            border: 4px solid #f59e0b !important;
        }

        .glow {
            animation: glow-pulse 2s infinite;
        }

        @keyframes glow-pulse {
            0% { box-shadow: 0 0 5px #f59e0b; }
            50% { box-shadow: 0 0 20px #fbbf24; }
            100% { box-shadow: 0 0 5px #f59e0b; }
        }

        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.9);
            z-index: 50;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .hint-img {
            width: 100%;
            max-height: 250px;
            object-fit: cover;
            border-radius: 12px;
            margin-bottom: 1rem;
            border: 3px solid #e2e8f0;
        }

        .story-box {
            background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%);
            color: white;
        }

        .error-shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }

        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        /* æŠ½çå‹•ç•«ç›¸é—œ */
        .slot-animation {
            animation: slot-roll 0.1s infinite linear;
        }

        @keyframes slot-roll {
            0% { transform: translateY(-5px); opacity: 0.7; }
            50% { transform: translateY(5px); opacity: 1; }
            100% { transform: translateY(-5px); opacity: 0.7; }
        }

        .prize-pop {
            animation: prize-reveal 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        @keyframes prize-reveal {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .floor-info {
            background-color: #f0f9ff;
            border-left: 4px solid #0ea5e9;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            text-align: left;
        }
    </style>
    <script>
        window.isSubmitted = false;
        window.handleIframeLoad = function() {
            if (window.isSubmitted && typeof window.showResult === 'function') {
                window.showResult();
            }
        };
    </script>
</head>
<body class="min-h-screen pb-10">

    <header class="story-box text-white py-8 px-6 shadow-xl text-center mb-8 relative overflow-hidden">
        <div class="relative z-10">
            <h1 class="text-3xl font-bold mb-2 text-white">æ™‚ç©ºæ¢éšªå®¶ï¼šè§£é– 250 å¹´çš„ç§˜å¯†</h1>
            <div class="max-w-2xl mx-auto text-sm md:text-base opacity-90 leading-relaxed bg-black/20 p-4 rounded-lg inline-block">
                æ¢éšªå®¶ä½ å¥½ï¼æˆ‘å€‘æ”¶åˆ°ä¸€å°ä¾†è‡ª 2027 å¹´çš„æ±‚æ•‘ä¿¡ï¼Œ<br>
                ç¾åœ‹å»ºåœ‹ 250 é€±å¹´çš„ã€Œæ™‚ç©ºä¹‹é‘°ã€ç¢æˆäº†äº”ç‰‡ï¼Œæ•£è½åœ¨åœ–æ›¸é¤¨å„è™•ã€‚<br>
                éœ€è¦ä½ é‹ç”¨è§€å¯ŸåŠ›æ‰¾å‡ºç¢ç‰‡ï¼Œé–‹å•Ÿé€šå¾€æ…¶å…¸çš„å¤§é–€ï¼
            </div>
        </div>
    </header>

    <main class="max-w-4xl mx-auto px-4">
        <!-- Progress -->
        <div class="mb-8 bg-white p-4 rounded-xl shadow-sm border border-gray-100">
            <div class="flex justify-between mb-2">
                <span class="text-sm font-medium text-blue-700">æ­·å²ç¢ç‰‡æ”¶é›†é€²åº¦</span>
                <span id="progress-text" class="text-sm font-medium text-blue-700">0 / 5</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-4 overflow-hidden">
                <div id="progress-bar" class="bg-gradient-to-r from-blue-600 to-red-500 h-4 rounded-full transition-all duration-500" style="width: 0%"></div>
            </div>
        </div>

        <!-- Grid -->
        <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-10">
            <div id="card-0" onclick="handleCardClick(0)" class="card card-inactive bg-white rounded-2xl p-4 flex flex-col items-center text-center shadow-md border-2 border-transparent">
                <div class="text-4xl mb-2">ğŸš¢</div>
                <div class="font-bold text-sm md:text-base">èˆªå‘æ–°ä¸–ç•Œ</div>
                <div id="status-0" class="text-xs mt-2 text-gray-500">å°‹æ‰¾ç¢ç‰‡ 1</div>
            </div>
            <div id="card-1" onclick="handleCardClick(1)" class="card card-inactive bg-white rounded-2xl p-4 flex flex-col items-center text-center shadow-md border-2 border-transparent">
                <div class="text-4xl mb-2">âš¡</div>
                <div class="font-bold text-sm md:text-base">å¯Œè˜­å…‹æ—çš„é¢¨ç®</div>
                <div id="status-1" class="text-xs mt-2 text-gray-500">å°‹æ‰¾ç¢ç‰‡ 2</div>
            </div>
            <div id="card-2" onclick="handleCardClick(2)" class="card card-inactive bg-white rounded-2xl p-4 flex flex-col items-center text-center shadow-md border-2 border-transparent">
                <div class="text-4xl mb-2">ğŸ“œ</div>
                <div class="font-bold text-sm md:text-base">è‡ªç”±çš„å®£è¨€</div>
                <div id="status-2" class="text-xs mt-2 text-gray-500">å°‹æ‰¾ç¢ç‰‡ 3</div>
            </div>
            <div id="card-3" onclick="handleCardClick(3)" class="card card-inactive bg-white rounded-2xl p-4 flex flex-col items-center text-center shadow-md border-2 border-transparent">
                <div class="text-4xl mb-2">ğŸš€</div>
                <div class="font-bold text-sm md:text-base">å‰µæ–°èˆ‡ç§‘æŠ€</div>
                <div id="status-3" class="text-xs mt-2 text-gray-500">å°‹æ‰¾ç¢ç‰‡ 4</div>
            </div>
            <div id="card-4" onclick="handleCardClick(4)" class="card card-inactive bg-white rounded-2xl p-4 flex flex-col items-center text-center shadow-md border-2 border-transparent">
                <div class="text-4xl mb-2">ğŸ†</div>
                <div class="font-bold text-sm md:text-base">æ…¶ç¥ 250 é€±å¹´</div>
                <div id="status-4" class="text-xs mt-2 text-gray-500">å°‹æ‰¾ç¢ç‰‡ 5</div>
            </div>
        </div>
    </main>

    <!-- Modals -->
    <div id="modal" class="modal-overlay">
        <div id="modal-container" class="bg-white rounded-2xl max-w-md w-full p-6 shadow-2xl relative overflow-y-auto max-h-[90vh]">
            <button onclick="closeModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 z-10 bg-white rounded-full p-1 shadow">âœ•</button>
            <div id="modal-content"></div>
        </div>
    </div>

    <div id="final-modal" class="modal-overlay">
        <div class="bg-white rounded-3xl max-w-md w-full shadow-2xl overflow-hidden border-4 border-blue-900">
            <div class="bg-blue-900 p-6 text-center">
                <h2 class="text-white text-xl font-bold tracking-widest">æ™‚ç©ºä¹‹é‘°å·²ä¿®å¾©ï¼</h2>
            </div>
            
            <div id="final-step-1" class="p-8 text-center">
                <div class="text-5xl mb-4">ğŸŠ</div>
                <p class="text-slate-600 mb-6 text-sm">è«‹å¡«å¯«åŸºæœ¬è³‡æ–™ï¼Œé ˜å–æ¦®è€€çå‹µï¼</p>
                <div class="space-y-4 mb-6 text-left">
                    <input type="text" id="userName" placeholder="æ¢éšªå®¶å§“å" class="w-full bg-slate-100 border-none p-4 rounded-xl focus:ring-2 ring-blue-500 outline-none">
                    <div class="flex gap-2">
                        <select id="userGender" class="w-full bg-slate-100 border-none p-4 rounded-xl focus:ring-2 ring-blue-500 outline-none">
                            <option value="">é¸æ“‡æ€§åˆ¥</option>
                            <option value="ç”·">ç”·</option>
                            <option value="å¥³">å¥³</option>
                        </select>
                        <input type="tel" id="userPhone" maxlength="3" placeholder="æ‰‹æ©Ÿæœ«ä¸‰ç¢¼" class="w-full bg-slate-100 border-none p-4 rounded-xl focus:ring-2 ring-blue-500 text-center outline-none">
                    </div>
                </div>
                <button onclick="goToStaff()" class="w-full bg-blue-700 hover:bg-blue-800 text-white font-bold py-4 rounded-xl shadow-lg transition">å‰å¾€æ«ƒæª¯æ ¸éŠ·</button>
            </div>

            <div id="final-step-2" class="hidden p-8 text-center space-y-4">
                <div class="text-5xl">ğŸ”</div>
                <h3 class="text-xl font-bold text-amber-600">é¤¨å“¡æ ¸éŠ·ç¢ºèª</h3>
                <p class="text-slate-500 text-xs">è«‹å°‡æ‰‹æ©Ÿäº¤çµ¦æ«ƒæª¯äººå“¡é€²è¡Œæ ¸éŠ·ã€‚</p>
                <div class="bg-amber-50 p-6 rounded-2xl border border-amber-200 space-y-4">
                    <input type="password" id="admin-pass" placeholder="è«‹è¼¸å…¥æ ¸éŠ·ç¢¼" class="w-full bg-white border-2 border-amber-200 p-4 rounded-xl text-center font-bold outline-none">
                    <button onclick="verifyStaff()" class="w-full bg-amber-500 hover:bg-amber-600 text-white font-bold py-4 rounded-xl shadow-md">ç¢ºèªæ ¸éŠ·</button>
                </div>
            </div>

            <div id="final-step-3" class="hidden p-8 text-center space-y-6">
                <!-- æŠ½çé¡¯ç¤ºå€ -->
                <div class="relative h-40 flex items-center justify-center overflow-hidden bg-slate-50 rounded-2xl border-2 border-slate-200">
                    <div id="slot-container" class="text-center">
                        <div id="p-icon" class="text-7xl mb-2">ğŸ</div>
                        <div id="slot-text" class="text-2xl font-black text-slate-400">æº–å‚™æŠ½å–...</div>
                    </div>
                    
                    <!-- çµæœé¡¯ç¤ºå€ (åˆå§‹éš±è—) -->
                    <div id="p-res-box" class="hidden absolute inset-0 bg-emerald-50 flex flex-col items-center justify-center prize-pop border-2 border-emerald-400 rounded-2xl">
                        <span class="text-emerald-600 text-xs font-bold block mb-1">ğŸŠ ç²å¾—çé … ğŸŠ</span>
                        <h3 id="p-name" class="text-3xl font-black text-slate-800"></h3>
                        <p class="text-emerald-700 text-xs mt-2 font-medium">æ•¸æ“šå·²å‚³è¼¸è‡³ç¸½éƒ¨</p>
                    </div>
                </div>

                <button id="draw-btn" onclick="startDrawEffect()" class="w-full bg-emerald-600 hover:bg-emerald-500 text-white font-bold py-5 rounded-xl text-xl shadow-xl transition transform active:scale-95">æŠ½å–æ™‚ç©ºçå‹µ</button>
                
                <p id="draw-hint" class="text-slate-400 text-xs">é»æ“ŠæŒ‰éˆ•é–‹å§‹éš¨æ©ŸæŠ½é¸</p>
            </div>
        </div>
    </div>

    <!-- Hidden Form -->
    <iframe name="hidden_iframe" id="hidden_iframe" style="display:none;" onload="if(window.handleIframeLoad) window.handleIframeLoad()"></iframe>
    <form id="google_form" action="https://docs.google.com/forms/u/0/d/e/1FAIpQLSdg6LfPyeAu4DxLISW2WZrHmxoOQxsX_Pt6yN707eS8yDk9kg/formResponse" method="POST" target="hidden_iframe" style="display:none;">
        <input type="hidden" name="entry.1113228551" id="entry_name">
        <input type="hidden" name="entry.1705607062" id="entry_gender">
        <input type="hidden" name="entry.423374402" id="entry_phone">
        <input type="hidden" name="entry.1443014865" id="entry_prize">
    </form>

    <script>
        const ADMIN_CODE = "888";
        const PRIZE_POOL = ["éš¨èº«å¤¾", "æ‰‹æè¢‹", "ç´€å¿µå¾½ç« "];
        let finalPrize = "";

        const questData = [
            {
                floorName: "1æ¨“ï¼šå…¥é¤¨å¤§å»³èˆ‡æœå‹™å€",
                floorIntro: "é€™è£¡æ˜¯æ¢éšªçš„ç¬¬ä¸€ç«™ï¼Œæä¾›è¾¦è­‰ã€å€Ÿé‚„æ›¸æœå‹™ï¼Œé‚„æœ‰å„ç¨®ç²¾å½©çš„ä¸»é¡Œæ›¸å±•åœ¨é€™è£¡å±•å‡ºå–”ï¼",
                hintTitle: "æ•…äº‹çš„èµ·é»ï¼šåœ¨1æ¨“æ‰¾æ‰¾ï¼Œä»Šå¹´å¯’å‡é–±è®€ç¯€æ˜¯ä»‹ç´¹å“ªå€‹åœ‹å®¶å‘¢ï¼Ÿ",
                hintImage: "https://lh3.googleusercontent.com/u/0/d/14063RDGtNvicj-CV7w5ZGm-HQkSEjNHR", 
                qrKey: "æ³°åœ‹",
                question: "å¯’å‡é–±è®€ç¯€çš„ä¸»é¡Œæ˜¯ï¼Ÿ",
                options: ["ã€Œæ³°ã€æƒ³è¦‹ä½ ", "ã€Œæ³°ã€äº«é–±è®€", "ã€Œæ³°ã€æœƒè®€æ›¸", "ã€Œæ³°ã€åº¦æ±ºå®šä¸€åˆ‡"],
                answer: 1,
                icon: "ğŸš¢"
            },
            {
                floorName: "B1ï¼šå…’ç«¥åœ–æ›¸é¤¨ã€å³å¤§çŒ·æ›¸æˆ¿",
                floorIntro: "é€™è£¡æ˜¯å°æœ‹å‹çš„ç§˜å¯†åŸºåœ°ï¼æœ‰è±å¯Œçš„ä¸­æ–‡æ•…äº‹æ›¸ã€ç§‘å­¸æ›¸ï¼Œé‚„æœ‰å°ˆé–€ç‚ºå°æœ‹å‹è¨­è¨ˆçš„é–±è®€ç©ºé–“ã€‚",
                hintTitle: "ç§‘å­¸èˆ‡è§€å¯Ÿï¼šå‰å¾€B1æ‰¾æ‰¾é€™å€‹äººæ˜¯èª°ï¼Ÿ",
                hintImage: "https://lh3.googleusercontent.com/u/0/d/1OpoBd-w7bm7dYv7bCXFj72MlkiXUP_g9",
                qrKey: "å³å¤§çŒ·",
                question: "ä½æ–¼åŒ—å¸‚åœ–ç¸½é¤¨B1çš„å…’ç«¥å®¤ï¼Œæ¯é€±äºŒï½å…­çš„é–‹æ”¾æ™‚é–“æ˜¯å¹¾é»å‘¢ï¼Ÿ",
                options: ["09:00-17:00", "09:00-21:00", "09:00-18:00", "08:30-21:00"],
                answer: 2,
                icon: "âš¡"
            },
            {
                floorName: "9æ¨“ï¼šå¤šå…ƒæ–‡åŒ–è³‡æ–™ä¸­å¿ƒ",
                floorIntro: "ä¸­å¿ƒè£¡åˆ†æˆ8å€‹å€åŸŸï¼Œåˆ†åˆ¥ä»£è¡¨ä¸åŒåœ‹å®¶ï¼Œå¯ä»¥ä¾†é€™è£¡æ¢ç´¢ä¸åŒåœ‹å®¶æœ‰è¶£çš„æ•…äº‹å’ŒçŸ¥è­˜ï¼",
                hintTitle: "è‡ªç”±çš„å®£è¨€ï¼šæŠµé”9æ¨“ï¼Œå¤§é–€ä¸€æ‰“é–‹çœ‹åˆ°çš„åœ‹å®¶æ˜¯å“ªè£¡å‘¢ï¼Ÿ",
                hintImage: "https://placehold.co/600x400/ef4444/white?text=9æ¨“å¤šå…ƒæ–‡åŒ–å€",
                qrKey: "æ³°åœ‹",
                question: "åœ‹æ——ä¸‰è§’å½¢çš„ä¸€é‚Šæœ‰ä¸‰é¡†æ˜Ÿèˆ‡å¤ªé™½ï¼Œå³å´æ˜¯è—ç´…å…©è‰²ã€‚è«‹å•æ˜¯å“ªå€‹åœ‹å®¶å‘¢ï¼Ÿ",
                options: ["éŸ“åœ‹", "ç·¬ç”¸", "æ³°åœ‹", "è²å¾‹è³“"],
                answer: 3,
                icon: "ğŸ“œ"
            },
            {
                floorName: "8æ¨“ï¼šè¦–è½å®¤",
                floorIntro: "é™¤äº†å¯å¤–å€Ÿè³‡æ–™ï¼Œä¹Ÿè¨­æœ‰è¦–è½å…§é–±å€ã€‚é‚„æœ‰å®šæœŸæ”¾æ˜ ç†±é–€é›»å½±å’Œèˆ‰è¾¦éŸ³æ¨‚ã€é›»å½±è¬›åº§ã€‚",
                hintTitle: "é‚å‘æœªä¾†ï¼šå‰å¾€8æ¨“è¦–è½å®¤ï¼Œä½ çœ‹åˆ°çš„æ˜¯ä»€éº¼å‘¢ï¼Ÿ",
                hintImage: "https://placehold.co/600x400/10b981/white?text=8æ¨“è¦–è½å®¤",
                qrKey: "åœ˜é«”æ¬£è³å®¤",
                question: "åœ¨è‡ºåŒ—å¸‚ç«‹åœ–æ›¸é¤¨ï¼Œå¤–å€Ÿè¦–è½è³‡æ–™å€ŸæœŸæ˜¯å¹¾å¤©ï¼Ÿé‚„å¯å†çºŒå€Ÿå¹¾æ¬¡å‘¢ï¼Ÿ",
                options: ["14å¤©ï¼Œ2æ¬¡", "14å¤©ï¼Œ3æ¬¡", "30å¤©ï¼Œ2æ¬¡", "30å¤©ï¼Œ3æ¬¡"],
                answer: 1,
                icon: "ğŸš€"
            },
            {
                floorName: "3æ¨“ï¼šç¾åœ‹è³‡æ–™ä¸­å¿ƒ",
                floorIntro: "æ¢éšªçš„çµ‚é»ä¾†åˆ°3æ¨“ç¾åœ‹è³‡æ–™ä¸­å¿ƒï¼Œé€™è£¡æ­£èˆ‰è¾¦ã€Œç¾åœ‹å»ºåœ‹ 250 é€±å¹´ (America250)ã€ç‰¹åˆ¥å±•è¦½ã€‚",
                hintTitle: "250 é€±å¹´ç‰¹å±•ï¼šè«‹æ‰¾åˆ° America250 ç‰¹å±•æµ·å ±ï¼Œè§€å¯Ÿæµ·å ±ä¸Šçš„ç²¾ç¥æ¨™èªã€‚",
                hintImage: "https://placehold.co/600x400/8b5cf6/white?text=3æ¨“ç‰¹å±•æµ·å ±",
                qrKey: "05",
                question: "ç¾åœ‹å»ºåœ‹ 250 é€±å¹´ (America250) çš„æ ¸å¿ƒæ…¶ç¥ç²¾ç¥æ˜¯ä»€éº¼ï¼Ÿ",
                options: ["ç¡è¦ºèˆ‡ä¼‘æ¯", "å¤šå…ƒã€è‡ªç”±èˆ‡æœªä¾†", "è²·æ±è¥¿èˆ‡è³¼ç‰©", "è€ƒè©¦èˆ‡å¯«ä½œæ¥­"],
                answer: 1,
                icon: "ğŸ†"
            }
        ];

        let gameState = {
            completed: [false, false, false, false, false],
            currentTask: null
        };

        function init() { updateProgress(); }

        function handleCardClick(index) {
            if (gameState.completed[index]) {
                showModal(`<div class="text-center p-4"><div class="text-6xl mb-4">ğŸ’</div><h2 class="text-2xl font-bold text-blue-600 mb-2">æ­·å²ç¢ç‰‡å·²æ”¶é›†</h2><p class="text-gray-600">ä½ å·²ç¶“æˆåŠŸç²å¾—äº†é€™ä¸€å€çš„ç¢ç‰‡ï¼</p></div>`);
                return;
            }
            gameState.currentTask = index;
            const task = questData[index];
            showModal(`
                <div class="text-center">
                    <h2 class="text-xl font-bold text-blue-800 mb-2">ğŸ“ ç¬¬ ${index+1} å€‹ç¢ç‰‡ä½ç½®</h2>
                    <img src="${task.hintImage}" alt="æç¤ºç…§ç‰‡" class="hint-img shadow-lg" onerror="this.src='https://placehold.co/600x400?text=ç…§ç‰‡è¼‰å…¥ä¸­...'">
                    <p class="text-base text-gray-800 font-bold mb-6">${task.hintTitle}</p>
                    <div class="bg-blue-50 p-6 rounded-2xl border-2 border-blue-200">
                        <input type="text" id="modal-qr-input" placeholder="åœ¨æ­¤è¼¸å…¥ç­”æ¡ˆ" class="w-full px-4 py-3 border-2 border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 uppercase font-bold text-center mb-2">
                        <div id="error-msg" class="text-red-500 text-xs font-bold hidden mb-2">âŒ ç­”æ¡ˆä¸æ­£ç¢ºï¼</div>
                        <button onclick="checkPasscode(${index})" class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg shadow-md">ç¢ºèª</button>
                    </div>
                </div>
            `);
        }

        function checkPasscode(index) {
            const input = document.getElementById('modal-qr-input').value.trim().toUpperCase();
            if (input === questData[index].qrKey.toUpperCase()) { showQuestion(index); }
            else { document.getElementById('error-msg').classList.remove('hidden'); }
        }

        function showQuestion(index) {
            const task = questData[index];
            let optionsHtml = task.options.map((opt, i) => `<button onclick="checkAnswer(${i})" class="w-full text-left p-4 mb-3 border-2 border-gray-100 rounded-xl hover:border-blue-500 hover:bg-blue-50 active:scale-95"><span class="inline-block w-8 h-8 bg-blue-600 text-white rounded-full text-center leading-8 mr-3 font-bold">${i+1}</span><span class="text-gray-700">${opt}</span></button>`).join('');
            showModal(`<div><div class="flex items-center gap-2 mb-2"><span class="text-3xl">${task.icon}</span><h2 class="text-xl font-bold">ç¢ç‰‡ä»»å‹™ï¼š${index + 1}</h2></div><div class="floor-info"><p class="text-sm text-sky-900">${task.floorIntro}</p></div><p class="text-lg text-gray-800 mb-6 font-bold">${task.question}</p><div id="quiz-error" class="hidden bg-red-100 text-red-600 p-2 rounded-lg mb-4 text-center">âŒ ç­”æ¡ˆä¸æ­£ç¢ºï¼</div><div>${optionsHtml}</div></div>`);
        }

        function checkAnswer(selectedIndex) {
            if (selectedIndex === questData[gameState.currentTask].answer) {
                gameState.completed[gameState.currentTask] = true;
                updateCardUI(gameState.currentTask);
                updateProgress();
                showModal(`<div class="text-center p-4"><div class="text-6xl mb-4 animate-bounce">âœ¨</div><h2 class="text-2xl font-bold text-green-600 mb-2">æ­£ç¢ºç­”æ¡ˆï¼</h2><button onclick="closeModal()" class="bg-blue-600 text-white px-10 py-3 rounded-full font-bold">ç¹¼çºŒæ¢éšª</button></div>`);
                checkGameWin();
            } else { document.getElementById('quiz-error').classList.remove('hidden'); }
        }

        function updateCardUI(index) {
            const card = document.getElementById(`card-${index}`);
            const status = document.getElementById(`status-${index}`);
            card.classList.remove('card-inactive');
            card.classList.add('card-active', 'glow');
            status.innerText = "ç¢ç‰‡å·²æ”¶é›† âœ¨";
            status.classList.add('text-blue-600', 'font-bold');
        }

        function updateProgress() {
            const doneCount = gameState.completed.filter(c => c).length;
            document.getElementById('progress-bar').style.width = `${(doneCount / 5) * 100}%`;
            document.getElementById('progress-text').innerText = `${doneCount} / 5`;
        }

        function checkGameWin() { if (gameState.completed.every(c => c)) setTimeout(() => document.getElementById('final-modal').classList.add('active'), 1000); }

        function goToStaff() {
            const n = document.getElementById('userName').value.trim();
            const g = document.getElementById('userGender').value;
            const p = document.getElementById('userPhone').value.trim();
            if(!n || !g || !p) { alert("è«‹å¡«å¯«æ‰€æœ‰è³‡æ–™ï¼"); return; }
            document.getElementById('final-step-1').classList.add('hidden');
            document.getElementById('final-step-2').classList.remove('hidden');
        }

        function verifyStaff() {
            if(document.getElementById('admin-pass').value === ADMIN_CODE) {
                document.getElementById('final-step-2').classList.add('hidden');
                document.getElementById('final-step-3').classList.remove('hidden');
            } else { alert("æ ¸éŠ·ç¢¼éŒ¯èª¤ï¼"); }
        }

        // --- æŠ½çå‹•ç•«é‚è¼¯ ---
        function startDrawEffect() {
            const btn = document.getElementById('draw-btn');
            const slotText = document.getElementById('slot-text');
            const slotContainer = document.getElementById('slot-container');
            const hint = document.getElementById('draw-hint');
            
            btn.disabled = true;
            btn.classList.add('opacity-50', 'cursor-not-allowed');
            hint.innerText = "æŠ½é¸ä¸­ï¼Œè«‹å±æ¯ä»¥å¾…...";
            
            // é–‹å§‹è½‰å‹•å‹•ç•«
            slotContainer.classList.add('slot-animation');
            
            let counter = 0;
            const duration = 2000; // æ»¾å‹•æ™‚é–“ 2.5 ç§’
            const intervalTime = 80;
            
            const rollInterval = setInterval(() => {
                slotText.innerText = PRIZE_POOL[counter % PRIZE_POOL.length];
                counter++;
            }, intervalTime);

            // çµæŸè½‰å‹•
            setTimeout(() => {
                clearInterval(rollInterval);
                slotContainer.classList.remove('slot-animation');
                
                // æ±ºå®šæœ€çµ‚çµæœ
                finalPrize = PRIZE_POOL[Math.floor(Math.random() * PRIZE_POOL.length)];
                
                // æ­£å¼æäº¤æ•¸æ“š
                submitData(finalPrize);
            }, duration);
        }

        function submitData(prize) {
            document.getElementById('entry_name').value = document.getElementById('userName').value;
            document.getElementById('entry_gender').value = document.getElementById('userGender').value;
            document.getElementById('entry_phone').value = document.getElementById('userPhone').value;
            document.getElementById('entry_prize').value = prize;

            window.isSubmitted = true;
            document.getElementById('google_form').submit();
            
            // å»¶é²ä¸€é»é»é¡¯ç¤ºçµæœï¼Œå¢åŠ é©šå–œæ„Ÿ
            setTimeout(() => {
                window.showResult();
            }, 500);
        }

        window.showResult = function() {
            if (!window.isSubmitted) return;
            document.getElementById('p-name').innerText = finalPrize;
            document.getElementById('p-res-box').classList.remove('hidden');
            document.getElementById('draw-btn').style.display = 'none';
            document.getElementById('draw-hint').style.display = 'none';
            window.isSubmitted = false;
        };

        function showModal(content) { document.getElementById('modal-content').innerHTML = content; document.getElementById('modal').classList.add('active'); }
        function closeModal() { document.getElementById('modal').classList.remove('active'); }
        window.onload = init;
    </script>
</body>
</html>
