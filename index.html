<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ–æ›¸é¤¨æ¢éšªå®¶ - ç¾åœ‹ 250 æ™‚ç©ºèˆªè¡Œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f1f5f9;
        }

        /* é—–é—œå¡ç‰‡æ¨£å¼ */
        .card {
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            perspective: 1000px;
            cursor: pointer;
        }
        .card-inactive { filter: grayscale(100%) brightness(70%); }
        .card-active {
            filter: none;
            transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(245, 158, 11, 0.4);
            border: 4px solid #f59e0b !important;
        }

        /* æ¨¡æ…‹æ¡†æ¨£å¼ */
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.95);
            z-index: 50;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(8px);
        }
        .modal-overlay.active { display: flex; }

        /* æ‹‰éœ¸å®¹å™¨ */
        .slot-container {
            height: 120px;
            overflow: hidden;
            position: relative;
            background: #1e293b;
            border-radius: 1.5rem;
            border: 6px solid #f87171;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
            transition: all 0.5s ease;
        }
        .slot-reel { transition: transform 3.5s cubic-bezier(0.15, 0, 0.15, 1); will-change: transform; }
        .slot-item {
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: 900;
            color: white;
            white-space: nowrap;
        }
        .is-winner {
            border-color: #4ade80 !important;
            background: #064e3b !important;
            box-shadow: 0 0 30px rgba(74, 222, 128, 0.5);
            animation: win-glow 1s infinite alternate;
        }
        @keyframes win-glow { from { transform: scale(1); } to { transform: scale(1.02); } }
        .prize-text { font-size: 2rem !important; color: #facc15 !important; text-shadow: 0 0 15px rgba(250, 204, 21, 0.6); }

        .hint-img { width: 100%; max-height: 250px; object-fit: cover; border-radius: 12px; margin-bottom: 1rem; border: 3px solid #e2e8f0; }
        .story-box { background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%); color: white; }
        .glow { animation: glow-pulse 2s infinite; }
        @keyframes glow-pulse { 0%, 100% { box-shadow: 0 0 5px #f59e0b; } 50% { box-shadow: 0 0 20px #fbbf24; } }
    </style>
</head>
<body class="min-h-screen pb-10">

    <header class="story-box text-white py-8 px-6 shadow-xl text-center mb-8 relative">
        <h1 class="text-3xl font-bold mb-2">æ™‚ç©ºæ¢éšªå®¶ï¼šè§£é– 250 å¹´çš„ç§˜å¯†</h1>
        <div class="max-w-2xl mx-auto text-sm opacity-90 bg-black/20 p-4 rounded-lg">
            æ¢éšªå®¶ä½ å¥½ï¼æˆ‘å€‘æ”¶åˆ°ä¸€å°æ±‚æ•‘ä¿¡ï¼Œ<br>
            ç¾åœ‹å»ºåœ‹250é€±å¹´çš„ã€Œæ™‚ç©ºä¹‹é‘°ã€ç¢æˆäº†äº”ç‰‡ï¼Œæ•£è½åœ¨åœ–æ›¸é¤¨å„è™•ã€‚<br>
            éœ€è¦ä½ é‹ç”¨è§€å¯ŸåŠ›å’Œæ™ºæ…§æ‰¾å‡ºç¢ç‰‡ï¼Œé–‹å•Ÿé€šå¾€æ…¶å…¸çš„å¤§é–€ï¼
        </div>
    </header>

    <main class="max-w-4xl mx-auto px-4">
        <!-- é€²åº¦æ¢ -->
        <div class="mb-8 bg-white p-4 rounded-xl shadow-sm border border-gray-100">
            <div class="flex justify-between mb-2">
                <span class="text-sm font-medium text-blue-700">æ­·å²ç¢ç‰‡æ”¶é›†é€²åº¦</span>
                <span id="progress-text" class="text-sm font-medium text-blue-700">0 / 5</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-4 overflow-hidden">
                <div id="progress-bar" class="bg-gradient-to-r from-blue-600 to-red-500 h-4 rounded-full transition-all duration-500" style="width: 0%"></div>
            </div>
        </div>

        <!-- ç¢ç‰‡ç¶²æ ¼ -->
        <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-10">
            <div id="card-0" onclick="handleCardClick(0)" class="card card-inactive bg-white rounded-2xl p-4 flex flex-col items-center text-center shadow-md border-2 border-transparent">
                <div class="text-4xl mb-2">ğŸš¢</div>
                <div class="font-bold text-sm">èˆªå‘æ–°ä¸–ç•Œ</div>
                <div id="status-0" class="text-xs mt-2 text-gray-500">å°‹æ‰¾ç¢ç‰‡1</div>
            </div>
            <div id="card-1" onclick="handleCardClick(1)" class="card card-inactive bg-white rounded-2xl p-4 flex flex-col items-center text-center shadow-md border-2 border-transparent">
                <div class="text-4xl mb-2">âš¡</div>
                <div class="font-bold text-sm">å¯Œè˜­å…‹æ—çš„é¢¨ç®</div>
                <div id="status-1" class="text-xs mt-2 text-gray-500">å°‹æ‰¾ç¢ç‰‡2</div>
            </div>
            <div id="card-2" onclick="handleCardClick(2)" class="card card-inactive bg-white rounded-2xl p-4 flex flex-col items-center text-center shadow-md border-2 border-transparent">
                <div class="text-4xl mb-2">ğŸ“œ</div>
                <div class="font-bold text-sm">è‡ªç”±çš„å®£è¨€</div>
                <div id="status-2" class="text-xs mt-2 text-gray-500">å°‹æ‰¾ç¢ç‰‡3</div>
            </div>
            <div id="card-3" onclick="handleCardClick(3)" class="card card-inactive bg-white rounded-2xl p-4 flex flex-col items-center text-center shadow-md border-2 border-transparent">
                <div class="text-4xl mb-2">ğŸš€</div>
                <div class="font-bold text-sm">å‰µæ–°èˆ‡ç§‘æŠ€</div>
                <div id="status-3" class="text-xs mt-2 text-gray-500">å°‹æ‰¾ç¢ç‰‡4</div>
            </div>
            <div id="card-4" onclick="handleCardClick(4)" class="card card-inactive bg-white rounded-2xl p-4 flex flex-col items-center text-center shadow-md border-2 border-transparent">
                <div class="text-4xl mb-2">ğŸ†</div>
                <div class="font-bold text-sm">æ…¶ç¥250</div>
                <div id="status-4" class="text-xs mt-2 text-gray-500">å°‹æ‰¾ç¢ç‰‡5</div>
            </div>
        </div>
    </main>

    <!-- ä¸€èˆ¬é—–é—œ Modal -->
    <div id="modal" class="modal-overlay">
        <div id="modal-container" class="bg-white rounded-2xl max-w-md w-full p-6 shadow-2xl relative overflow-y-auto max-h-[90vh]">
            <button onclick="closeModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 z-10">âœ•</button>
            <div id="modal-content"></div>
        </div>
    </div>

    <!-- æœ€å¾Œæ ¸éŠ·èˆ‡æŠ½ç Modal -->
    <div id="final-modal" class="modal-overlay">
        <div class="bg-white rounded-[2.5rem] max-w-md w-full shadow-2xl overflow-hidden border-8 border-slate-900">
            <div class="bg-slate-900 p-6 text-center">
                <h2 class="text-yellow-400 text-xl font-black italic tracking-widest uppercase">AMERICA 250 REWARD</h2>
            </div>
            
            <!-- å¡«å¯«è³‡æ–™ -->
            <div id="final-step-1" class="p-8 text-center">
                <div class="text-5xl mb-4">ğŸŠ</div>
                <h3 class="text-xl font-bold mb-6">æ”¶é›†æˆåŠŸï¼è«‹å¡«å¯«è³‡æ–™</h3>
                <div class="space-y-4 mb-8 text-left">
                    <input type="text" id="userName" placeholder="æ¢éšªå®¶å§“å" class="w-full bg-slate-100 border-4 border-slate-200 p-4 rounded-2xl outline-none focus:border-blue-500 font-bold">
                    <div class="flex gap-3">
                        <select id="userGender" class="w-1/3 bg-slate-100 border-4 border-slate-200 p-4 rounded-2xl outline-none focus:border-blue-500 font-bold">
                            <option value="">æ€§åˆ¥</option>
                            <option value="ç”·">ç”·</option>
                            <option value="å¥³">å¥³</option>
                        </select>
                        <input type="tel" id="userPhone" placeholder="é›»è©±" class="w-2/3 bg-slate-100 border-4 border-slate-200 p-4 rounded-2xl outline-none focus:border-blue-500 font-bold text-center">
                    </div>
                </div>
                <button onclick="goToStaff()" class="w-full bg-blue-600 text-white font-black py-5 rounded-3xl text-xl shadow-[0_8px_0_#1e3a8a] active:translate-y-1 active:shadow-none transition-all">
                    æäº¤ â”
                </button>
            </div>

            <!-- é¤¨å“¡æ ¸éŠ· -->
            <div id="final-step-2" class="hidden p-8 text-center space-y-4">
                <div class="text-5xl">ğŸ‘®</div>
                <h3 class="text-2xl font-black text-red-600">æ¢éšªå®¶èº«ä»½å·²ç¢ºèª</h3>
                <p class="text-slate-500 font-bold">å‘3Fé¤¨å“¡è©¢å•è§£é–å¯†ç¢¼</p>
                <div class="bg-slate-900 p-8 rounded-[2rem] space-y-4">
                    <input type="password" id="admin-pass" maxlength="3" placeholder="å¯†ç¢¼" class="w-full bg-white border-4 border-blue-400 p-4 rounded-2xl text-center font-black text-4xl outline-none">
                    <button onclick="verifyStaff()" class="w-full bg-yellow-400 text-slate-900 font-black py-4 rounded-2xl text-xl shadow-[0_6px_0_#b45309] active:translate-y-1 active:shadow-none transition-all">
                        é–‹å•ŸæŠ½çè£ç½®
                    </button>
                </div>
                <button onclick="resetToStep1()" class="text-slate-400 font-bold text-sm underline">å›ä¸Šä¸€æ­¥</button>
            </div>

            <!-- å–®ä¸€æŠ½çæ¡† -->
            <div id="final-step-3" class="hidden p-8 text-center space-y-6">
                <h2 id="draw-title" class="text-2xl font-black text-slate-800">ğŸ—½å¹¸é‹å¤§è½‰ç›¤</h2>

                <div id="main-slot" class="slot-container relative">
                    <div id="reel" class="slot-reel"></div>
                </div>

                <button id="draw-btn" onclick="startSlotMachine()" class="w-full bg-red-500 hover:bg-red-600 text-white font-black py-5 rounded-[2rem] text-2xl shadow-[0_10px_0_#991b1b] active:translate-y-2 active:shadow-none transition-all">
                    å•Ÿå‹•ï¼GO!
                </button>
                
                <div id="final-message" class="hidden text-green-600 font-black text-lg animate-bounce mt-4">ğŸŠ è«‹å‡ºç¤ºç•«é¢é ˜å–çé … ğŸŠ</div>
                <p id="submit-status" class="text-xs font-bold text-slate-400">è£ç½®å·²å¾…å‘½...</p>
            </div>
        </div>
    </div>

    <script>
        const ADMIN_CODE = "888";
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz8hkaLz4VwugcciBIKQnJMald50OYoHLxYQYU01iGL2Lcbt9QCi9VKySFwI8rYsrYphA/exec";
        
        const PRIZE_POOL = [
            { name: "ğŸ éš¨èº«å¤¾", weight: 45 },
            { name: "ğŸ¥¤ æ¯å¥—", weight: 45 },
            { name: "âœ¨ å……é›»å™¨", weight: 10 }
        ];
        const DECOR_ICONS = ["ğŸ¦…", "ğŸ—½", "âš¾", "ğŸ", "ğŸª", "ğŸ¸", "ğŸ¤ ","ğŸ”"];
        const REEL_COUNT = 50;

        // é¡Œç›®è³‡æ–™åº«
        const questData = [
            { floorName: "1Fï¼šå…¥é¤¨å¤§å»³èˆ‡æœå‹™å€", floorIntro: "é€™è£¡æ˜¯æ¢éšªçš„ç¬¬ä¸€ç«™ï¼Œæä¾›è¾¦è­‰ã€å€Ÿé‚„æ›¸æœå‹™ï¼Œé‚„æœ‰å„ç¨®ç²¾å½©çš„ä¸»é¡Œæ›¸å±•åœ¨é€™è£¡å±•å‡ºå–”ï¼æ˜¯è®€è€…èˆ‡æ›¸ç±ç›¸é‡çš„èµ·å§‹é»ï¼Œå……æ»¿äº†æ¢ç´¢çš„å¯èƒ½ã€‚", hintTitle: "æ•…äº‹çš„èµ·é»ï¼šæ‰¾æ‰¾ä»Šå¹´å¯’å‡é–±è®€ç¯€æ˜¯ä»‹ç´¹å“ªå€‹åœ‹å®¶å‘¢ï¼Ÿ", hintImage: "https://lh3.googleusercontent.com/u/0/d/14063RDGtNvicj-CV7w5ZGm-HQkSEjNHR", qrKey: "æ³°åœ‹", question: "ä»Šå¹´å¯’å‡é–±è®€ç¯€çš„ä¸»é¡Œæ˜¯ï¼Ÿ", options: ["ã€Œæ³°ã€æƒ³è¦‹ä½ ", "ã€Œæ³°ã€äº«é–±è®€", "ã€Œæ³°ã€æœƒè®€æ›¸", "ã€Œæ³°ã€åº¦æ±ºå®šä¸€åˆ‡"], answer: 1, icon: "ğŸš¢" },
            { floorName: "B1ï¼šå…’ç«¥å®¤ã€å³å¤§çŒ·æ›¸æˆ¿, B2ï¼šå°å°ä¸–ç•Œå¤–æ–‡åœ–æ›¸é¤¨", floorIntro: "é€™è£¡æ˜¯å°æœ‹å‹çš„ç§˜å¯†åŸºåœ°ï¼æœ‰è±å¯Œçš„æ•…äº‹æ›¸ã€ç¹ªæœ¬ä»¥åŠå°ˆç‚ºå…’ç«¥è¨­è¨ˆçš„é–±è®€ç©ºé–“ï¼Œè®“å­©å­åœ¨æ›¸æµ·ä¸­å±•é–‹å¥‡å¹»å†’éšªã€‚", hintTitle: "ç§‘å­¸èˆ‡è§€å¯Ÿï¼šå‰å¾€B1æ‰¾æ‰¾é€™å€‹äººæ˜¯èª°ï¼Ÿ", hintImage: "https://lh3.googleusercontent.com/u/0/d/1OpoBd-w7bm7dYv7bCXFj72MlkiXUP_g9", qrKey: "å³å¤§çŒ·", question: "å…’ç«¥å®¤æ¯é€±äºŒï½å…­çš„é–‹æ”¾æ™‚é–“æ˜¯ï¼Ÿ", options: ["09:00-17:00", "09:00-21:00", "09:00-18:00", "08:30-21:00"], answer: 2, icon: "âš¡" },
            { floorName: "9Fï¼šå¤šå…ƒæ–‡åŒ–è³‡æ–™ä¸­å¿ƒ", floorIntro: "ä¸­å¿ƒè£¡åˆ†æˆ8å€‹å€åŸŸï¼Œåˆ†åˆ¥ä»£è¡¨ä¸åŒåœ‹å®¶ï¼Œå±•ç¤ºäº†ä¾†è‡ªä¸–ç•Œå„åœ°çš„æ–‡åŒ–ç¸®å½±ï¼Œé€éä¸åŒèªæ–‡çš„è—æ›¸èˆ‡å±•è¦½ï¼Œå¸¶é ˜ä½ è·¨è¶Šåœ‹ç•Œï¼Œé«”é©—æœ‰è¶£çš„è·¨æ–‡åŒ–çŸ¥è­˜ã€‚", hintTitle: "è‡ªç”±çš„å®£è¨€ï¼šä½æ–¼9æ¨“æ«ƒæª¯å‰æ–¹çš„æ›¸æ¶æ˜¯å“ªå€‹åœ‹å®¶çš„å°ˆå€å‘¢ï¼Ÿ", hintImage: "https://placehold.co/600x400/ef4444/white?text=9æ¨“å¤šå…ƒæ–‡åŒ–å€", qrKey: "æ³°åœ‹", question: "åœ‹æ——çš„ä¸€é‚Šæ˜¯ç­‰é‚Šä¸‰è§’å½¢ï¼Œæ¯å€‹è§’éƒ½æœ‰ä¸€é¡†æ˜Ÿæ˜Ÿï¼Œä¸‰è§’å½¢çš„ä¸­å¤®æœ‰ä¸€å€‹å¤ªé™½ï¼Œä¸‰è§’å½¢çš„å³å´æ˜¯è—ç´…å…©è‰²ã€‚è«‹å•æ˜¯å“ªå€‹åœ‹å®¶å‘¢ï¼Ÿ", options: ["éŸ“åœ‹", "ç·¬ç”¸", "æ³°åœ‹", "è²å¾‹è³“"], answer: 3, icon: "ğŸ“œ" },
            { floorName: "8Fï¼šè¦–è½å®¤", floorIntro: "åœ¨é€™è£¡ï¼Œæ•…äº‹ä¸åªåœ¨æ›¸æœ¬è£¡ï¼Œæ›´åœ¨è¢å¹•èˆ‡è€³æ©Ÿä¸­ã€‚è¦–è½å®¤æä¾›è±å¯Œçš„å½±éŸ³è³‡æ–™å€Ÿé–±ï¼Œä¸¦è¨­æœ‰è¦–è½å…§é–±å€ï¼Œ3äººä»¥ä¸Šé‚„å¯ç™»è¨˜ä½¿ç”¨å¦‚åŒåŒ…å»‚å¼çš„è¦ªå­æ¬£è³å®¤ã€‚æ­¤å¤–ï¼Œé‚„æœƒå®šæœŸæ”¾æ˜ ç†±é–€é›»å½±å’Œèˆ‰è¾¦éŸ³æ¨‚ã€é›»å½±è¬›åº§åŠæ”¶çœ‹ä¸²æµå½±éŸ³æœå‹™ï¼Œæ­¡è¿å¤§æœ‹å‹å°æœ‹å‹ä¾†å…è²»æ¬£è³ã€‚", hintTitle: "é‚å‘æœªä¾†ï¼šå‰å¾€8æ¨“ï¼Œä½ æœƒå…ˆçœ‹åˆ°ï¼Ÿ", hintImage: "https://placehold.co/600x400/10b981/white?text=8æ¨“è¦–è½å®¤", qrKey: "åœ˜é«”æ¬£è³å®¤", question: "åŒ—å¸‚åœ–çš„è¦–è½è³‡æ–™å€ŸæœŸæ˜¯å¹¾å¤©ï¼Ÿå¯çºŒå€Ÿå¹¾æ¬¡ï¼Ÿ", options: ["14å¤©ï¼Œ2æ¬¡", "14å¤©ï¼Œ3æ¬¡", "30å¤©ï¼Œ2æ¬¡", "30å¤©ï¼Œ3æ¬¡"], answer: 1, icon: "ğŸš€" },
            { floorName: "3Fï¼šåƒè€ƒå®¤ã€ç¾åœ‹è³‡æ–™ä¸­å¿ƒã€ç•™å­¸è³‡æ–™ä¸­å¿ƒ", floorIntro: "æ¢éšªçš„çµ‚é»ç«™ï¼é€™è£¡å…¸è—äº†è±å¯Œçš„ç¾åœ‹æ­·å²èˆ‡æ–‡åŒ–è³‡è¨Šï¼Œç›®å‰çš„ America250 ç‰¹åˆ¥å±•è¦½æ­£è¨´èªªè‘—è·¨è¶Šå…©ä¸–ç´€çš„è‡ªç”±æ•…äº‹ã€‚", hintTitle: "æ‰¾åˆ° America250 ç‰¹å±•æµ·å ±è§€å¯Ÿæ¨™èª æ¸¬è©¦ç­”æ¡ˆ05ã€‚", hintImage: "https://placehold.co/600x400/8b5cf6/white?text=3æ¨“ç‰¹å±•æµ·å ±", qrKey: "05", question: "America250 çš„æ ¸å¿ƒæ…¶ç¥ç²¾ç¥æ˜¯ä»€éº¼ï¼Ÿ", options: ["ç¡è¦ºèˆ‡ä¼‘æ¯", "å¤šå…ƒã€è‡ªç”±èˆ‡æœªä¾†", "è²·æ±è¥¿èˆ‡è³¼ç‰©", "è€ƒè©¦èˆ‡å¯«ä½œæ¥­"], answer: 1, icon: "ğŸ†" }
        ];

        let gameState = { completed: [false, false, false, false, false], currentTask: null };

        function init() {
            updateProgress();
            initReel();
        }

        function initReel() {
            const reel = document.getElementById('reel');
            reel.innerHTML = '';
            for(let i=0; i<REEL_COUNT; i++) {
                const div = document.createElement('div');
                div.className = 'slot-item';
                div.innerText = DECOR_ICONS[i % DECOR_ICONS.length];
                reel.appendChild(div);
            }
        }

        function handleCardClick(i) {
            if (gameState.completed[i]) return showModal(`<div class="text-center p-4"><div class="text-6xl mb-4">ğŸ’</div><h2 class="text-2xl font-bold text-blue-600">ç¢ç‰‡å·²æ”¶é›†</h2></div>`);
            gameState.currentTask = i;
            const task = questData[i];
            showModal(`
                <div class="text-center">
                    <h2 class="text-xl font-bold text-blue-800 mb-2">ğŸ“ ç¬¬ ${i+1} å€‹ç¢ç‰‡ä½ç½®</h2>
                    <img src="${task.hintImage}" class="hint-img shadow-lg" onerror="this.src='https://placehold.co/600x400?text=ç…§ç‰‡è¼‰å…¥ä¸­...'">
                    <p class="font-bold mb-4 text-gray-700">${task.hintTitle}</p>
                    <div class="bg-blue-50 p-6 rounded-2xl border-2 border-blue-200">
                        <input type="text" id="modal-qr-input" placeholder="è¼¸å…¥ç­”æ¡ˆ" class="w-full p-4 border-2 rounded-xl text-center mb-2 font-bold uppercase outline-none focus:border-blue-500">
                        <div id="error-msg" class="text-red-500 text-xs font-bold hidden mb-2">âŒ ç­”æ¡ˆä¸æ­£ç¢ºï¼</div>
                        <button onclick="checkPasscode(${i})" class="w-full bg-blue-600 text-white font-bold py-3 rounded-xl">ç¢ºèª</button>
                    </div>
                </div>
            `);
        }

        function checkPasscode(i) {
            const val = document.getElementById('modal-qr-input').value.trim().toUpperCase();
            if (val === questData[i].qrKey.toUpperCase()) showQuestion(i);
            else document.getElementById('error-msg').classList.remove('hidden');
        }

        function showQuestion(i) {
            const task = questData[i];
            let opts = task.options.map((opt, idx) => `
                <button onclick="checkAnswer(${idx})" class="w-full text-left p-4 mb-3 border-2 border-gray-100 rounded-xl hover:border-blue-500 hover:bg-blue-50 transition shadow-sm">
                    <span class="inline-block w-8 h-8 bg-blue-600 text-white rounded-full text-center leading-8 mr-3 font-bold">${idx+1}</span>
                    <span class="font-medium text-gray-700">${opt}</span>
                </button>
            `).join('');

            showModal(`
                <div>
                    <!-- 1. æ¨™é¡Œ (ç”± floorName ç›´æ¥å¸¶å…¥) -->
                    <div class="flex items-center gap-2 mb-4 border-b-2 border-blue-100 pb-2">
                        <span class="text-3xl">${task.icon}</span>
                        <h2 class="text-xl font-black text-blue-900">${task.floorName}</h2>
                    </div>
                    
                    <!-- 2. æ¨“å±¤ç°¡ä»‹ -->
                    <div class="bg-blue-50 p-4 rounded-xl mb-6 border-l-4 border-blue-400">
                        <p class="text-sm text-blue-800 leading-relaxed font-bold">
                            <span class="bg-blue-200 px-2 py-0.5 rounded text-xs mr-1">æ¨“å±¤æ¢ç´¢</span>
                            ${task.floorIntro}
                        </p>
                    </div>

                    <!-- 3. é¡Œç›®å…§å®¹ -->
                    <p class="text-lg font-black mb-6 text-gray-800 leading-tight">
                        <span class="text-red-500 mr-1">Q:</span>${task.question}
                    </p>

                    <!-- 4. é¸é … -->
                    <div id="quiz-error" class="hidden text-red-600 mb-4 text-center font-bold animate-pulse">âŒ ç­”æ¡ˆä¸æ­£ç¢ºï¼Œè«‹å†è©¦ä¸€æ¬¡ï¼</div>
                    <div class="space-y-1">
                        ${opts}
                    </div>
                </div>
            `);
        }

        function checkAnswer(idx) {
            if (idx === questData[gameState.currentTask].answer) {
                gameState.completed[gameState.currentTask] = true;
                updateCardUI(gameState.currentTask);
                updateProgress();
                showModal(`<div class="text-center p-4"><div class="text-6xl mb-4 animate-bounce">âœ¨</div><h2 class="text-2xl font-bold text-green-600">æ­£ç¢ºç­”æ¡ˆï¼</h2><p class="text-gray-500 mt-2 font-bold">ç²å¾—ç¢ç‰‡äº†ï¼</p><button onclick="closeModal()" class="mt-6 bg-blue-600 text-white px-10 py-3 rounded-full font-bold shadow-lg">ç¹¼çºŒæ¢éšª</button></div>`);
                if (gameState.completed.every(c => c)) setTimeout(() => document.getElementById('final-modal').classList.add('active'), 1000);
            } else {
                const err = document.getElementById('quiz-error');
                if(err) err.classList.remove('hidden');
            }
        }

        function updateCardUI(i) {
            const c = document.getElementById(`card-${i}`);
            c.classList.remove('card-inactive');
            c.classList.add('card-active', 'glow');
            document.getElementById(`status-${i}`).innerText = "å·²æ”¶é›† âœ¨";
        }

        function updateProgress() {
            const count = gameState.completed.filter(c => c).length;
            const bar = document.getElementById('progress-bar');
            if(bar) bar.style.width = `${(count / 5) * 100}%`;
            const text = document.getElementById('progress-text');
            if(text) text.innerText = `${count} / 5`;
        }

        function goToStaff() {
            const n = document.getElementById('userName').value.trim();
            const p = document.getElementById('userPhone').value.trim();
            if (!n || !p) return alert("è«‹å¡«å¯«å§“åèˆ‡é›»è©±ï¼");
            document.getElementById('final-step-1').classList.add('hidden');
            document.getElementById('final-step-2').classList.remove('hidden');
        }

        function resetToStep1() {
            document.getElementById('final-step-2').classList.add('hidden');
            document.getElementById('final-step-1').classList.remove('hidden');
        }

        function verifyStaff() {
            if (document.getElementById('admin-pass').value === ADMIN_CODE) {
                document.getElementById('final-step-2').classList.add('hidden');
                document.getElementById('final-step-3').classList.remove('hidden');
            } else alert("æ ¸éŠ·å¯†ç¢¼éŒ¯èª¤ï¼");
        }

        function startSlotMachine() {
            const btn = document.getElementById('draw-btn');
            const mainSlot = document.getElementById('main-slot');
            const reel = document.getElementById('reel');
            
            btn.disabled = true;
            btn.style.opacity = "0.5";
            btn.innerText = "è½‰å‹•ä¸­...";
            document.getElementById('submit-status').innerText = "æ•¸æ“šç™¼é€ä¸­...";

            const random = Math.random() * 100;
            let cumulative = 0;
            let winPrize = "";
            for (const p of PRIZE_POOL) {
                cumulative += p.weight;
                if (random <= cumulative) { winPrize = p.name; break; }
            }

            submitData(winPrize);

            const stopIdx = REEL_COUNT - 3;
            const stopItem = reel.children[stopIdx];
            reel.style.transform = `translateY(-${stopIdx * 120}px)`;

            setTimeout(() => {
                stopItem.innerText = winPrize;
                stopItem.classList.add('prize-text');
            }, 2500);

            setTimeout(() => {
                mainSlot.classList.add('is-winner');
                document.getElementById('final-message').classList.remove('hidden');
                document.getElementById('draw-title').innerText = "âœ¨ æ­å–œç²ç âœ¨";
                btn.style.display = 'none';
            }, 3600);
        }

        async function submitData(prize) {
            const userName = document.getElementById('userName').value;
            const userGender = document.getElementById('userGender').value;
            const userPhone = document.getElementById('userPhone').value;
            const statusLabel = document.getElementById('submit-status');

            const formData = new URLSearchParams();
            formData.append('name', userName);
            formData.append('gender', userGender);
            formData.append('phone', userPhone);
            formData.append('prize', prize);

            try {
                await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    cache: 'no-cache',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: formData
                });
                
                statusLabel.innerText = "âœ… æ•¸æ“šå·²å‚³è¼¸è‡³ç¸½éƒ¨";
                statusLabel.classList.add('text-green-600');
            } catch (error) {
                statusLabel.innerText = "âš ï¸ ç¶²è·¯å‚³è¼¸ç•°å¸¸ï¼Œè«‹é¤¨å“¡æª¢æŸ¥";
                statusLabel.classList.add('text-red-500');
            }
        }

        function showModal(content) { document.getElementById('modal-content').innerHTML = content; document.getElementById('modal').classList.add('active'); }
        function closeModal() { document.getElementById('modal').classList.remove('active'); }
        
        window.onload = init;
    </script>
</body>
</html>
