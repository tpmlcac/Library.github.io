<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å·ç•«å¯†ç¢¼ï¼šè§£é–250å¹´çš„ç¥•å¯†éŠæˆ²æ•…äº‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700;900&family=Noto+Sans+TC:wght@400;700&display=swap');
        
        :root {
            --gold: #d4af37;
            --museum-bg: #2c2c2c;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f8f6f0;
            -webkit-user-select: none;
            user-select: none;
        }

        .serif { font-family: 'Noto Serif TC', serif; }

        /* æ•…äº‹å‰å‚³ç•«é¢ */
        #intro-overlay {
            position: fixed;
            inset: 0;
            background: radial-gradient(circle, #3d3d3d 0%, #1a1a1a 100%);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.8s ease, visibility 0.8s;
        }

        .intro-content {
            max-width: 600px;
            padding: 2.5rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(212, 175, 55, 0.3);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        /* åç•«å¡ç‰‡æ¨£å¼ */
        .frame-card {
            background: white;
            padding: 12px;
            border: 8px solid #3d2b1f;
            border-image: linear-gradient(to bottom right, #3d2b1f, #8b4513, #3d2b1f) 1;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }

        .card-inactive { filter: grayscale(100%) sepia(20%); opacity: 0.7; }
        .card-active {
            transform: translateY(-10px) scale(1.02);
            border-image: linear-gradient(to bottom right, #d4af37, #f9e29c, #d4af37) 1;
            box-shadow: 0 20px 35px rgba(212, 175, 55, 0.3);
        }

        /* æ¨¡æ…‹æ¡†æ¨£å¼ */
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 500;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }
        .modal-overlay.active { display: flex; }

        /* æ‹‰éœ¸æ¨£å¼ */
        .slot-container {
            height: 120px;
            overflow: hidden;
            background: #1a1a1a;
            border-radius: 1rem;
            border: 4px solid var(--gold);
            margin-bottom: 1rem;
        }
        .slot-reel { transition: transform 3.5s cubic-bezier(0.15, 0, 0.15, 1); }
        .slot-item { height: 120px; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; color: white; }

        .btn-gold {
            background: linear-gradient(135deg, #d4af37 0%, #aa891f 100%);
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        /* æœ€çµ‚ç•«é¢ä½ˆå±€ */
        .app-card {
            background: white;
            border-radius: 2.5rem;
            overflow: hidden;
            box-shadow: 0 20px 50px rgba(0,0,0,0.2);
            border: 2px solid #161b2b;
            width: 360px;
            min-height: 540px;
            display: flex;
            flex-direction: column;
        }
        .app-header {
            background: #161b2b;
            padding: 1.25rem;
            text-align: center;
        }
        .app-header h2 {
            color: #facc15;
            font-weight: 900;
            font-style: italic;
            letter-spacing: 0.1em;
            font-size: 1.25rem;
        }
        
        /* çé …é¡¯ç¤ºæ¡† */
        .prize-display-box {
            background: linear-gradient(145deg, #4a4a4a, #2d2d2d);
            border-radius: 2rem;
            padding: 3rem 1rem;
            width: 90%;
            margin: 1.5rem auto;
            box-shadow: inset 0 2px 10px rgba(255,255,255,0.1), 0 10px 20px rgba(0,0,0,0.2);
            border: 4px solid #777;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
        }
        
        .prize-display-box.claimed {
            background: #d1d5db !important;
            border-color: #9ca3af !important;
            box-shadow: none !important;
        }
        
        .prize-text {
            color: white;
            font-size: 2.25rem;
            font-weight: 900;
            text-shadow: 0 0 15px rgba(255,255,255,0.6);
        }
        
        .prize-text.claimed {
            color: #4b5563;
            text-shadow: none;
        }

        .check-icon-container {
            width: 80px;
            height: 80px;
            border-radius: 1.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
        }

        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { animation: fade-in 0.5s ease-out forwards; }
    </style>
</head>
<body>

    <!-- 1. æ•…äº‹å‰å‚³ç•«é¢ -->
    <div id="intro-overlay">
        <div class="intro-content text-center text-white px-6">
            <div class="mb-6">
                <span class="text-6xl">ğŸ¨</span>
            </div>
            <h1 class="text-3xl md:text-4xl font-black mb-6 serif tracking-widest text-yellow-500">
                å·ç•«å¯†ç¢¼ï¼š<br>è§£é–250å¹´çš„ç¥•å¯†éŠæˆ²
            </h1>
            <div class="text-lg leading-relaxed mb-8 opacity-90 text-left md:text-center font-light">
                ç‚ºäº†æ…¶ç¥ç¾åœ‹å»ºåœ‹250é€±å¹´ï¼Œåœ–æ›¸é¤¨ç¾åœ‹è³‡æ–™ä¸­å¿ƒæ­£åœ¨ç·Šé‘¼å¯†é¼“çš„ä½ˆç½®ï¼Œä¸¦è²·ä¾†äº†4å¹…çè²´çš„åç•«ä½œç‚ºå±•ç¤ºï¼Œé€™å¸å¼•äº†æ€ªç›œå¸ƒå¯çš„æ³¨æ„ï¼Œä»–åœ¨æŸå¤©æ™©ä¸Šå·å·æ½›å…¥åœ–æ›¸é¤¨ï¼Œå°‡é€™4å¹…åç•«æ›æˆè‡ªå·±çš„å¡—é´‰ä½œï¼Œä¸¦å’Œåœ–æ›¸é¤¨ç™¼å‡ºæŒ‘æˆ°...<br><br>
                éœ€è§£é–‹è—æ–¼å¡—é´‰ä½œä¸Šçš„è¬é¡Œï¼Œæ‰èƒ½æ‰¾å›çœŸæ­£çš„ç•«ä½œï¼Œè°æ˜çš„æ‚¨ï¼Œèƒ½å¹«å¿™åœ–æ›¸é¤¨è§£æ±ºé›£é¡Œå—ï¼Ÿæ­¡è¿å¤§å®¶ä¸€èµ·ä¾†æŒ‘æˆ°
            </div>
            <button onclick="startChallenge()" class="px-12 py-4 btn-gold rounded-full text-xl font-bold hover:scale-110 transition-transform shadow-2xl active:scale-95">
                é»æ“Šé€²å…¥æŒ‘æˆ° â”
            </button>
        </div>
    </div>

    <!-- 2. ä¸»æŒ‘æˆ°é é¢ -->
    <div id="main-content" class="hidden opacity-0 transition-opacity duration-1000 p-4 md:p-8">
        <header class="bg-stone-800 text-stone-200 py-10 px-6 shadow-2xl text-center mb-8 border-b-4 border-yellow-700">
            <h2 class="text-2xl font-black mb-2 serif tracking-widest text-yellow-500">è—è¡“é•·å»Šï¼šå¥ªå›æ¶ˆå¤±çš„åç•«</h2>
            <p class="text-sm opacity-60">æ‰¾å‡ºæ€ªç›œå¸ƒå¯ç•™ä¸‹çš„ç·šç´¢ï¼Œè§£é–‹å·ç•«å¯†ç¢¼</p>
        </header>

        <main class="max-w-5xl mx-auto">
            <div class="mb-10 bg-white p-6 rounded-lg shadow-inner border-2 border-stone-200">
                <div class="flex justify-between items-end mb-3">
                    <span class="text-stone-600 font-bold serif text-sm md:text-base">å·²æ‰¾å›çš„ç•«ä½œ</span>
                    <span id="progress-text" class="text-2xl font-black text-yellow-600">0 / 5</span>
                </div>
                <div class="w-full bg-stone-200 rounded-full h-4 overflow-hidden">
                    <div id="progress-bar" class="bg-gradient-to-r from-yellow-600 to-amber-400 h-4 rounded-full transition-all duration-700" style="width: 0%"></div>
                </div>
            </div>

            <div class="grid grid-cols-2 md:grid-cols-5 gap-4 md:gap-6 mb-12">
                <!-- ç•«ä½œå¡ç‰‡ 0-4 -->
                <div id="card-0" onclick="handleCardClick(0)" class="frame-card card-inactive flex flex-col items-center group">
                    <div class="w-full aspect-square bg-stone-100 flex items-center justify-center text-4xl mb-4 border border-stone-200">ğŸ–¼ï¸</div>
                    <div class="font-bold text-stone-800 text-center text-sm md:text-base">åç•«1 </div>
                    <div id="status-0" class="text-[12px] md:text-xs mt-2 text-stone-400">åœ°é»ï¼š1F æ•¸ä½ç‰†</div>
                </div>
                <div id="card-1" onclick="handleCardClick(1)" class="frame-card card-inactive flex flex-col items-center group">
                    <div class="w-full aspect-square bg-stone-100 flex items-center justify-center text-4xl mb-4 border border-stone-200">ğŸ—½</div>
                    <div class="font-bold text-stone-800 text-center text-sm md:text-base">åç•«2 </div>
                    <div id="status-1" class="text-[12px] md:text-xs mt-2 text-stone-400">åœ°é»ï¼šB1 å³å¤§çŒ¶æ›¸æˆ¿</div>
                </div>
                <div id="card-2" onclick="handleCardClick(2)" class="frame-card card-inactive flex flex-col items-center group">
                    <div class="w-full aspect-square bg-stone-100 flex items-center justify-center text-4xl mb-4 border border-stone-200">ğŸ°</div>
                    <div class="font-bold text-stone-800 text-center text-sm md:text-base">åç•«3 </div>
                    <div id="status-2" class="text-[12px] md:text-xs mt-2 text-stone-400">åœ°é»ï¼š8F è¦–è½å®¤</div>
                </div>
                <div id="card-3" onclick="handleCardClick(3)" class="frame-card card-inactive flex flex-col items-center group">
                    <div class="w-full aspect-square bg-stone-100 flex items-center justify-center text-4xl mb-4 border border-stone-200">ğŸ©</div>
                    <div class="font-bold text-stone-800 text-center text-sm md:text-base">åç•«4 </div>
                    <div id="status-3" class="text-[12px] md:text-xs mt-2 text-stone-400">åœ°é»ï¼š3Fç¾åœ‹è³‡æ–™ä¸­å¿ƒ</div>
                </div>
                <div id="card-4" onclick="handleCardClick(4)" class="frame-card card-inactive flex flex-col items-center bg-stone-50 group">
                    <div class="w-full aspect-square bg-stone-200 flex items-center justify-center text-4xl mb-4 border border-stone-300">ğŸ—ï¸</div>
                    <div class="font-bold text-stone-800 text-center text-sm md:text-base">å·ç•«å¯†ç¢¼</div>
                    <div id="status-4" class="text-[12px] md:text-xs mt-2 text-stone-400">è§£é–‹æœ€å¾Œè¬åœ˜</div>
                </div>
            </div>
        </main>
    </div>

    <!-- éŠæˆ²æ¨¡æ…‹æ¡† -->
    <div id="modal" class="modal-overlay">
        <div class="bg-stone-50 rounded-lg max-w-md w-full p-8 shadow-2xl relative border-t-8 border-yellow-600 mx-auto">
            <button onclick="closeModal()" class="absolute top-4 right-4 text-stone-400 hover:text-stone-800 font-bold text-xl">âœ•</button>
            <div id="modal-content"></div>
        </div>
    </div>

    <!-- çµç®—æŠ½çæ¨¡æ…‹æ¡† -->
    <div id="final-modal" class="modal-overlay">
        <div class="app-card animate-fade-in">
            <div class="app-header">
                <h2>MISSION ACCOMPLISHED</h2>
            </div>

            <!-- Step 1: å†’éšªçµæŸ -->
            <div id="final-step-1" class="p-8 text-center bg-white flex-grow flex flex-col justify-center">
                <h3 class="text-2xl font-black text-stone-800 mb-2">æŒ‘æˆ°æˆåŠŸï¼</h3>
                <div class="text-6xl my-6">ğŸ†</div>
                <p class="text-stone-600 font-bold mb-10 leading-relaxed px-2">
                    å¤ªå²å®³äº†ï¼è§£é–‹äº†æ‰€æœ‰çš„è¬é¡Œï¼Œæ€ªç›œå¸ƒå¯æœƒä¾ç…§ç´„å®šé‚„å›ç•«ä½œï¼Œè¬è¬æ‚¨å¹«äº†åœ–æ›¸é¤¨ä¸€å€‹å¤§å¿™ï¼Œç¾åœ¨è«‹æ‚¨å¸¶è‘—æ­¤ç•«é¢è‡³3æ¨“æœå‹™æ«ƒæª¯æ›å–çå‹µå§<br>
                </p>
                <button onclick="showStaffVerification()" class="w-full btn-gold font-bold py-4 rounded-xl shadow-lg">ä¸‹ä¸€æ­¥ â”</button>
            </div>

            <!-- Step 2: é©—è­‰ç¢¼è¼¸å…¥ -->
            <div id="final-step-2" class="hidden p-8 text-center bg-[#fdfcf8] flex-grow flex flex-col items-center justify-center space-y-4">
                <div class="text-5xl">ğŸ”</div>
                <h3 class="text-2xl font-black text-stone-800 serif">ç­‰ç­‰ æ«ƒæª¯ä¸Šå¥½åƒæœ‰... </h3>
                <p class="text-stone-600 font-bold leading-relaxed px-4 text-sm italic text-center">
                    ä»”ç´°è§€å¯Ÿæ«ƒæª¯å‘¨é­ï¼Œå°‹æ‰¾é‚£çµ„ç¥ç¥•çš„æ•¸å­—...
                </p>
                <div class="bg-stone-900 p-6 space-y-4 mt-6 rounded-lg w-full">
                    <input type="password" id="admin-pass" maxlength="3" placeholder="---" class="w-full bg-white border-4 border-yellow-600 p-4 text-center font-black text-4xl outline-none rounded-none">
                    <button onclick="verifyStaff()" class="w-full btn-gold font-black py-4 text-xl rounded shadow-lg active:scale-95 transition-all">è§£é–æŠ½çè£ç½®</button>
                </div>
                <button onclick="backToCelebration()" class="text-stone-400 text-xs font-bold hover:text-stone-600 pt-2 underline">å›ä¸Šä¸€é </button>
            </div>

            <!-- Step 3: æŠ½çèˆ‡ç¢ºèªç•«é¢ -->
            <div id="final-step-3" class="hidden p-8 text-center bg-white flex-grow flex flex-col justify-center">
                <h3 class="text-xl font-black text-stone-800 mb-2">å¹¸é‹è½‰ç›¤</h3>
                
                <div id="main-slot" class="slot-container">
                    <div id="reel" class="slot-reel"></div>
                </div>
                
                <button id="draw-btn" onclick="startSlotMachine()" class="w-full bg-red-600 text-white font-black py-4 text-xl rounded-xl shadow-lg active:scale-95">START!</button>
                
                <div id="prize-claim-area" class="hidden animate-fade-in flex flex-col items-center">
                    <div class="prize-display-box">
                        <span id="active-icon" class="text-3xl">ğŸ</span>
                        <span id="active-prize-name" class="prize-text">çé …å</span>
                    </div>

                    <div class="text-green-600 font-black text-lg animate-bounce mb-6">ğŸŠ é ˜çç¢ºèª ğŸŠ</div>
                    
                    <button id="confirm-claim-btn" onclick="confirmPrizeClaim()" class="w-full bg-green-600 text-white font-black py-4 rounded-xl shadow-[0_6px_0_#166534] active:shadow-none active:translate-y-1 transition-all">ç¢ºèªå·¥ä½œäººå“¡å·²æ ¸éŠ·</button>
                </div>
            </div>

            <!-- Step 4: å·²å…Œæ›å®Œæˆç•«é¢ -->
            <div id="final-step-4" class="hidden p-8 text-center bg-white flex-grow flex-col justify-center items-center">
                <h3 class="text-xl font-black text-stone-400 mb-2">å¹¸é‹è½‰ç›¤</h3>
                
                <div class="prize-display-box claimed">
                    <span id="final-icon" class="text-3xl opacity-50">ğŸ</span>
                    <span id="final-prize-name" class="prize-text claimed">çé …å</span>
                </div>

                <div class="flex flex-col items-center mt-4">
                    <div class="check-icon-container bg-gray-400 shadow-[0_6px_0_#9ca3af]">
                        <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" stroke-width="4" viewBox="0 0 24 24">
                            <path d="M5 13l4 4L19 7" stroke-linecap="round" stroke-linejoin="round"></path>
                        </svg>
                    </div>
                    <h4 class="text-2xl font-black text-stone-400 mb-1">å·²å…Œæ›å®Œç•¢</h4>
                </div>
            </div>
        </div>
    </div>

    <script>
        const ADMIN_CODE = "888"; 
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxQdzuP2Ob5LeW3n2PJTnWpksJUBK3mUD25Dv6TjpuRmMtYJyhmnkd7a2mAi0UTNlGf/exec"; 
        
        const PRIZE_POOL = [
            { name: "éš¨èº«å¤¾", weight: 45, icon: "ğŸ" },
            { name: "æ¯å¥—", weight: 45, icon: "ğŸ¥¤" },
            { name: "å……é›»å™¨", weight: 10, icon: "âš¡" }
        ];
        const DECOR_ICONS = ["ğŸ–¼ï¸", "ğŸ¨", "âœ’ï¸", "ğŸ›ï¸", "ğŸ­"];
        const REEL_COUNT = 50;
        const passwordChars = ["K", "O", "O", "B"];
        
        let currentWonPrize = ""; 
        let currentWonIcon = "";
        let gameState = { completed: [false, false, false, false, false], currentTask: null };

        const questData = [
            { floorName: "ç¾åœ‹ç¨ç«‹å®£è¨€å°æ•…äº‹", floorIntro: "å¾ˆä¹…ä»¥å‰ï¼Œ1700å¹´ä»£ä¸­æœŸï¼Œç¾åœ‹çš„13å€‹æ®–æ°‘åœ°é‚„æ˜¯è‹±åœ‹çš„ä¸€éƒ¨åˆ†ï¼Œä½†ä»–å€‘æ²’æœ‰ä»£è¡¨åœ¨è‹±åœ‹è­°æœƒï¼Œå»è¦ç¹³ç¨…ï¼Œå¤§å®¶å¾ˆç”Ÿæ°£ã€‚1776å¹´7æœˆ4æ—¥ï¼Œæ®–æ°‘åœ°çš„ä»£è¡¨åœ¨è²»åŸç°½ç½²äº†ã€Šç¨ç«‹å®£è¨€ã€‹ï¼Œå®£å¸ƒç¾åœ‹è„«é›¢è‹±åœ‹ï¼Œæˆç‚ºè‡ªç”±çš„åœ‹å®¶ã€‚å¾æ­¤ï¼Œæ¯å¹´7æœˆ4æ—¥ï¼Œç¾åœ‹äººéƒ½æ…¶ç¥ã€Œç¨ç«‹æ—¥ã€", hintTitle: "ç·šç´¢ï¼šé¦™è•‰åœ¨å“ªè£¡ï¼Ÿ", placeholder: '2å€‹æ•¸å­—', hintImage: "https://lh3.googleusercontent.com/d/1YU4pY1Z_CKOuHH8SX68N9vgEKDXlYTzu", qrKey: "A", question: "æ•¸ä½ç‰†ä¸­å±•ç¤ºè‘—ç¾åœ‹250é€±å¹´æ›¸å±•ï¼Œè«‹å•ä¸‹åˆ—å“ªä¸€æœ¬æ›¸åœ¨å±•ç¤ºä¸­ï¼Ÿ", options: ["ã€ŠCommon Senseã€‹", "ã€ŠHamiltonã€‹", "ã€ŠGreat Gatsbyã€‹", "ã€ŠThe Roadã€‹"], answer: 0 },
            { floorName: "ç¾åœ‹è‡ªç”±å¥³ç¥å°æ•…äº‹", floorIntro: "å¾ˆä¹…ä»¥å‰ï¼Œä¸€åº§åå«ã€Œè‡ªç”±å¥³ç¥ã€çš„å·¨å¤§å¥³ç¥åƒï¼Œç«™åœ¨ç´ç´„æ¸¯å£ï¼Œæ‰‹èˆ‰ç«ç‚¬è¿æ¥é æ–¹ä¾†çš„äººå€‘ã€‚å¥¹æ˜¯æ³•åœ‹é€çµ¦ç¾åœ‹çš„ç¦®ç‰©ï¼Œç”¨ä¾†ç´€å¿µç¾åœ‹ç¨ç«‹ç™¾å¹´ï¼Œä¹Ÿè±¡å¾µè‡ªç”±èˆ‡æ°‘ä¸»ã€‚å¥³ç¥çš„å³æ‰‹é«˜èˆ‰ç«ç‚¬ï¼Œä»£è¡¨å…‰æ˜èˆ‡å¸Œæœ›ï¼›å·¦æ‰‹æŠ±è‘—åˆ»æœ‰ã€Œ1776å¹´7æœˆ4æ—¥ã€çš„çŸ³æ¿ï¼Œé‚£æ˜¯ç¾åœ‹ã€Šç¨ç«‹å®£è¨€ã€‹çš„æ—¥æœŸã€‚", hintTitle: "ç·šç´¢ï¼šåœ–æ›¸çš„åˆ†é¡", placeholder: '3å€‹æ•¸å­—', hintImage: " https://lh3.googleusercontent.com/d/1OsbpAUKCGCIisQGD8Qd85wBnimW2VW9-", qrKey: "B", question: "ç¾åœ‹çš„åœ‹æ…¶æ—¥æ˜¯ï¼Ÿ", options: ["10æœˆ10æ—¥", "1æœˆ1æ—¥", "7æœˆ4æ—¥", "12æœˆ25æ—¥"], answer: 2 },
            { floorName: "ç¾åœ‹è¿ªå£«å°¼å°æ•…äº‹", floorIntro: "å¾ˆä¹…ä»¥å‰ï¼Œåœ¨ç¾åœ‹ï¼Œæœ‰ä¸€ä½æ„›ç•«ç•«ã€æ„›åšå¤¢çš„äººï¼Œä»–çš„åå­—å«è¯ç‰¹ãƒ»è¿ªå£«å°¼ï¼ˆWalt Disneyï¼‰ã€‚å¹´è¼•æ™‚ï¼Œä»–æ›¾ç¶“å› ç‚ºã€Œå¤ªæ²’æœ‰å‰µæ„ã€è€Œè¢«å ±ç¤¾è¾­é€€ã€‚å¾Œä¾†ï¼Œä»–å‰µæ¥­å¤±æ•—ï¼Œé€£æˆ¿ç§Ÿéƒ½ä»˜ä¸èµ·ï¼Œåªèƒ½ç¡åœ¨å·¥ä½œå®¤è£¡ã€‚ä½†è¯ç‰¹æ²’æœ‰æ”¾æ£„ã€‚æœ‰ä¸€å¤©ï¼Œä»–ç•«å‡ºäº†ä¸€éš»åœ“åœ“è€³æœµã€æ„›å¾®ç¬‘çš„å°è€é¼ ã€‚é€™éš»è€é¼ ï¼Œå«åš ç±³å¥‡ï¼ˆMickey Mouseï¼‰ã€‚ç±³å¥‡ç¬¬ä¸€æ¬¡å‡ºç¾åœ¨é›»å½±è£¡æ™‚ï¼Œæœƒèªªè©±ã€æœƒå”±æ­Œã€æœƒè·³èˆï¼Œ å…¨ä¸–ç•Œçš„å­©å­éƒ½æ„›ä¸Šäº†ä»–ã€‚ å¾Œä¾†ï¼Œè¯ç‰¹è¿ªå£«å°¼èªªäº†ä¸€å¥å¾ˆæœ‰åçš„è©±ï¼šã€Œå¦‚æœä½ èƒ½å¤¢æƒ³ï¼Œä½ å°±èƒ½åšåˆ°ã€‚ã€æ–¼æ˜¯ï¼Œä»–åœ¨ç¾åœ‹å»ºäº†ä¸€å€‹ç‰¹åˆ¥çš„åœ°æ–¹ï¼Œé‚£è£¡æ²’æœ‰ç…©æƒ±ï¼Œåªæœ‰æ­¡ç¬‘å’Œå¤¢æƒ³ã€‚é€™å€‹åœ°æ–¹ï¼Œå°±æ˜¯ è¿ªå£«å°¼æ¨‚åœ’ã€‚", hintTitle: "ç·šç´¢ï¼šå¤§å®¶ä¾†æ‰¾ç¢´", placeholder: '7å€‹è‹±æ–‡å­—æ¯', hintImage: " https://lh3.googleusercontent.com/d/1QidveeUFrddfIHRqY9Y9Hd-btTKYyVdZ", qrKey: "C", question: "åœ–æ›¸é¤¨æ¨å‡ºã€Œæ–°å‚³åª’æ•¸ä½å…¬æ’­å¹³å°(EZMovie)ã€ï¼Œæä¾›äº†è¨±å¤šç¾åœ‹è¿ªå£«å°¼é›»å½±å…è²»è§€çœ‹ï¼Œè«‹å•åœ¨â€œç…å­ç‹ï¼šæœ¨æ³•æ²™â€é›»å½±å…§...(åœ¨è¦–è½å®¤å…§å³å¯è§€çœ‹å®Œæ•´é›»å½±) ", options: ["å¤ªç©ºå†’éšª", "æ£®æ—ç‹å­çš„æ•…äº‹", "æœ¨æ³•æ²™å¦‚ä½•æˆç‚ºç…å­ç‹", "æµ·æ´‹æ¢éšª"], answer: 2 },
            { floorName: "ç¾åœ‹æ—è‚¯ç¸½çµ±å°æ•…äº‹", floorIntro: "å¾ˆä¹…å¾ˆä¹…ä»¥å‰ï¼Œç¾åœ‹æœ‰ä¸€ä½éå¸¸æœ‰åçš„ç¸½çµ±ï¼Œå«åšäºä¼¯æ‹‰ç½•ï¼æ—è‚¯ã€‚åœ¨ä»–é‚„æ²’ç•¶ç¸½çµ±ã€åªæ˜¯å€‹å¹´è¼•äººçš„æ™‚å€™ï¼Œä»–åœ¨ä¸€å®¶å°é›œè²¨åº—å·¥ä½œã€‚æœ‰ä¸€å¤©æ™šä¸Šï¼Œæ—è‚¯æº–å‚™é—œåº—æ™‚ï¼Œç™¼ç¾è‡ªå·±å¤šæ”¶äº†ä¸€ä½å®¢äººä¸€åˆ†éŒ¢ã€‚é‚£åªæ˜¯ä¸€é»é»éŒ¢ï¼Œå®¢äººä¹Ÿæ—©å°±èµ°é äº†ï¼Œä½†æ—è‚¯å¿ƒè£¡ä¸€ç›´ä¸å®‰ã€‚æ–¼æ˜¯ï¼Œä»–èµ°äº†å¥½å¹¾å…¬åŠ›çš„è·¯ï¼Œåªç‚ºäº†æŠŠé‚£ä¸€åˆ†éŒ¢è¦ªæ‰‹é‚„çµ¦å®¢äººã€‚å®¢äººéå¸¸é©šè¨ï¼Œä¹Ÿéå¸¸æ„Ÿå‹•ã€‚å¾Œä¾†ï¼Œå¤§å®¶éƒ½å«æ—è‚¯ã€Œèª å¯¦çš„æ—è‚¯ï¼ˆHonest Abeï¼‰ã€ã€‚å¤šå¹´ä»¥å¾Œï¼Œæ—è‚¯æˆç‚ºäº†ç¾åœ‹ç¸½çµ±ï¼Œå¸¶é ˜åœ‹å®¶åº¦éå›°é›£çš„æ™‚åˆ»ã€‚äººå€‘ç›¸ä¿¡ï¼Œæ­£æ˜¯é€™ä»½èª å¯¦èˆ‡æ­£ç›´çš„å“æ ¼ï¼Œè®“ä»–æˆç‚ºä¸€ä½å‰å¤§çš„é ˜è¢–ã€‚", hintTitle: "ç·šç´¢ï¼šç¾åœ‹åœ‹æ——çš„é¡è‰²", placeholder: '3å€‹è‹±æ–‡å­—æ¯', hintImage: "https://placehold.co/800x800?text=Honest+Lincoln", qrKey: "D", question: "æ—è‚¯ç¸½çµ±å› ç‚ºä»€éº¼è¡Œç‚ºè¢«ç¨±ç‚ºã€Œèª å¯¦çš„æ—è‚¯ã€ï¼Ÿ", options: ["æ­¸é‚„å¤šæ”¶çš„ä¸€åˆ†éŒ¢", "ä»–å¾ä¸èªªè¬Š", "å‹‡æ–¼æ‰¿èªéŒ¯èª¤", "æ‹¯æ•‘åœ‹å®¶"], answer: 0 },
            { floorName: "çµ‚æ¥µç ´è§£ï¼šæ€ªç›œçš„å¯†é‘°", floorIntro: "", hintTitle: " ", hintImage: "https://lh3.googleusercontent.com/d/1SxK5AkiK-Ty2_SNhZjGI9g0bNiiyfuNx", qrKey: "BOOK", question: "", options: [], answer: -1 }
        ];

        function startChallenge() {
            const overlay = document.getElementById('intro-overlay');
            const main = document.getElementById('main-content');
            overlay.style.opacity = '0';
            overlay.style.visibility = 'hidden';
            main.classList.remove('hidden');
            setTimeout(() => { main.style.opacity = '1'; }, 50);
        }

        function handleCardClick(i) {
            if (gameState.completed[i]) { showSuccessMessage(i); return; }
            if (i === 4) {
                const firstFourCompleted = gameState.completed.slice(0, 4).every(c => c);
                if (!firstFourCompleted) {
                    showModal(`
                        <div class="text-center py-6">
                            <div class="text-6xl mb-6">ğŸ”’</div>
                            <h2 class="text-2xl font-black text-stone-800 mb-4 serif">ç·šç´¢ä¸è¶³</h2>
                            <p class="text-stone-600 font-bold px-4">è«‹å…ˆæ‰¾å›å‰ 4 å¹…åç•«ï¼</p>
                            <button onclick="closeModal()" class="mt-8 bg-stone-800 text-white px-12 py-4 font-bold rounded shadow-lg">è¿”å›å°‹æ‰¾</button>
                        </div>
                    `);
                    return;
                }
            }
            gameState.currentTask = i;
            const task = questData[i];
            showModal(`
                <div class="text-center">
                    <h2 class="text-xl md:text-2xl font-black text-stone-800 mb-6 serif border-b-2 border-yellow-600 pb-2">å°‹æ‰¾ç·šç´¢ï¼š${task.floorName}</h2>
                    <div class="mb-4 overflow-hidden rounded border-4 border-stone-200"><img src="${task.hintImage}" class="w-full h-auto object-cover"></div>
                    <p class="font-bold mb-6 text-stone-600">${task.hintTitle}</p>
                    <div class="bg-stone-200 p-4 rounded">
                        <input type="text" id="modal-qr-input" placeholder="${task.placeholder}" class="w-full p-4 border-2 border-stone-400 rounded-none text-center mb-4 font-black uppercase outline-none focus:border-yellow-600">
                        <div id="error-msg" class="text-red-600 text-xs font-bold hidden mb-4">âŒ å­—ä¸²ä¸åŒ¹é…</div>
                        <button onclick="checkPasscode(${i})" class="w-full bg-stone-800 text-white font-bold py-4 hover:bg-black transition-colors rounded">è§£æç·šç´¢</button>
                    </div>
                </div>
            `);
        }

        function checkPasscode(i) {
            const val = document.getElementById('modal-qr-input').value.trim().toUpperCase();
            if (val === questData[i].qrKey.toUpperCase()) {
                if (i === 4) completeTask(4);
                else showQuestion(i);
            } else { document.getElementById('error-msg').classList.remove('hidden'); }
        }

        function showQuestion(i) {
            const task = questData[i];
            let opts = task.options.map((opt, idx) => `
                <button onclick="checkAnswer(${idx})" class="w-full text-left p-4 mb-3 border-2 border-stone-200 hover:border-yellow-600 hover:bg-yellow-50 transition-all font-bold text-stone-700 flex items-center rounded bg-white">
                    <span class="flex-shrink-0 w-8 h-8 bg-stone-800 text-white text-center leading-8 mr-4 rounded-full text-sm">${idx+1}</span>
                    <span class="flex-grow text-sm md:text-base">${opt}</span>
                </button>
            `).join('');
            showModal(`<div class="serif"><h2 class="text-xl font-black text-stone-900 mb-2">${task.floorName}</h2><div class="bg-stone-100 p-3 border-l-4 border-stone-800 mb-4 text-stone-600 leading-relaxed text-xs italic">${task.floorIntro}</div><p class="text-lg font-black mb-6 text-stone-800">å•é¡Œï¼š${task.question}</p><div id="quiz-error" class="hidden text-red-600 mb-4 text-center font-bold">âŒ å›ç­”éŒ¯èª¤ï¼Œè«‹å†è©¦ä¸€æ¬¡ï¼</div><div class="space-y-1">${opts}</div></div>`);
        }

        function checkAnswer(idx) {
            if (idx === questData[gameState.currentTask].answer) completeTask(gameState.currentTask);
            else document.getElementById('quiz-error').classList.remove('hidden');
        }

        function completeTask(i) {
            gameState.completed[i] = true;
            updateCardUI(i);
            updateProgress();
            if (gameState.completed.every(c => c)) {
                closeModal();
                setTimeout(() => { document.getElementById('final-modal').classList.add('active'); }, 300);
            } else { showSuccessMessage(i); }
        }

        function showSuccessMessage(i) {
            let successContent = i < 4 
                ? `<h2 class="text-2xl font-black text-green-700 serif mb-4 opacity-80">æ­£ç¢ºç­”æ¡ˆï¼</h2><h3 class="text-4xl font-black text-stone-900 mb-6 serif">ç²å¾—å¯†ç¢¼ <span class="text-yellow-600 underline">${passwordChars[i]}</span></h3>`
                : `<h2 class="text-4xl font-black text-green-700 serif mb-4">è§£é–‹æœ€å¾Œè¬åœ˜</h2>`;
            showModal(`<div class="text-center py-6"><div class="text-7xl mb-8 animate-pulse">âœ¨</div>${successContent}<button onclick="closeModal()" class="mt-8 bg-stone-800 text-white px-12 py-4 font-bold rounded shadow-lg">ç¢ºèª</button></div>`);
        }

        function updateCardUI(i) {
            const c = document.getElementById(`card-${i}`);
            c.classList.remove('card-inactive', 'group');
            c.classList.add('card-active');
            const status = document.getElementById(`status-${i}`);
            if(status) { status.innerText = "å·²æ‰¾å› âœ¨"; status.classList.replace('text-stone-400', 'text-yellow-600'); }
            c.querySelector('div:first-child').innerText = 'ğŸ¨';
        }

        function updateProgress() {
            const count = gameState.completed.filter(c => c).length;
            document.getElementById('progress-bar').style.width = `${(count / 5) * 100}%`;
            document.getElementById('progress-text').innerText = `${count} / 5`;
        }

        function verifyStaff() {
            if (document.getElementById('admin-pass').value === ADMIN_CODE) {
                document.getElementById('final-step-2').classList.add('hidden');
                document.getElementById('final-step-3').classList.remove('hidden');
                initReel();
            } else {
                alert("æŸ¥é©—ç¢¼ä¸æ­£ç¢ºï¼Œè«‹æ´½è©¢æ«ƒæª¯äººå“¡ã€‚");
            }
        }

        function initReel() {
            const reel = document.getElementById('reel');
            reel.innerHTML = '';
            for(let i=0; i<REEL_COUNT; i++) {
                const div = document.createElement('div');
                div.className = 'slot-item';
                div.innerText = DECOR_ICONS[i % DECOR_ICONS.length];
                reel.appendChild(div);
            }
        }

        function startSlotMachine() {
            const btn = document.getElementById('draw-btn');
            const reel = document.getElementById('reel');
            const slotBox = document.getElementById('main-slot');
            
            btn.disabled = true;
            btn.innerText = "æŠ½é¸ä¸­...";
            
            const random = Math.random() * 100;
            let winObj = PRIZE_POOL[0];
            if(random < 10) winObj = PRIZE_POOL[2];
            else if(random < 55) winObj = PRIZE_POOL[0];
            else winObj = PRIZE_POOL[1];

            currentWonPrize = winObj.name;
            currentWonIcon = winObj.icon;

            const stopIdx = REEL_COUNT - 3;
            reel.style.transform = `translateY(-${stopIdx * 120}px)`;
            
            setTimeout(() => {
                slotBox.classList.add('hidden');
                btn.classList.add('hidden');
                document.getElementById('active-icon').innerText = currentWonIcon;
                document.getElementById('active-prize-name').innerText = currentWonPrize;
                document.getElementById('prize-claim-area').classList.remove('hidden');
            }, 3500);
        }

        function confirmPrizeClaim() {
            const btn = document.getElementById('confirm-claim-btn');
            btn.disabled = true;
            btn.innerText = "è¨˜éŒ„ç™¼é€ä¸­...";

            const timestamp = new Date().toLocaleString('zh-TW', { hour12: false });
            const prizeName = currentWonPrize || "æœªçŸ¥çé …";

            const formData = new URLSearchParams();
            formData.append('timestamp', timestamp);
            formData.append('prize', prizeName);

            fetch(GOOGLE_SCRIPT_URL, { 
                method: 'POST', 
                mode: 'no-cors', 
                body: formData 
            })
            .then(() => {
                completeClaimUI();
            })
            .catch(e => {
                console.error("å‚³é€å¤±æ•—:", e);
                completeClaimUI();
            });
        }

        function completeClaimUI() {
            document.getElementById('final-icon').innerText = currentWonIcon;
            document.getElementById('final-prize-name').innerText = currentWonPrize;
            document.getElementById('final-step-3').classList.add('hidden');
            document.getElementById('final-step-4').classList.remove('hidden');
            document.getElementById('final-step-4').classList.add('flex'); 
        }

        function showStaffVerification() {
            document.getElementById('final-step-1').classList.add('hidden');
            document.getElementById('final-step-2').classList.remove('hidden');
        }

        function backToCelebration() {
            document.getElementById('final-step-2').classList.add('hidden');
            document.getElementById('final-step-1').classList.remove('hidden');
        }

        function showModal(content) { 
            document.getElementById('modal-content').innerHTML = content; 
            document.getElementById('modal').classList.add('active'); 
        }
        function closeModal() { document.getElementById('modal').classList.remove('active'); }
        
        window.onload = () => { 
            document.oncontextmenu = () => false; 
        };
    </script>
</body>
</html>
